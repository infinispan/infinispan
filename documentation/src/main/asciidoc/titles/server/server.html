<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<title>Deploying and Configuring {brandname} {infinispanversion} Servers</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Deploying and Configuring {brandname} {infinispanversion} Servers</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#server_start">1. Getting Started with {brandname} Server</a>
<ul class="sectlevel2">
<li><a href="#_brandname_server_requirements">1.1. {brandname} Server Requirements</a></li>
<li><a href="#_downloading_server_distributions">1.2. Downloading Server Distributions</a></li>
<li><a href="#_installing_brandname_server">1.3. Installing {brandname} Server</a></li>
<li><a href="#server_quickstart">1.4. Running {brandname} Servers</a>
<ul class="sectlevel3">
<li><a href="#_starting_brandname_servers">1.4.1. Starting {brandname} Servers</a></li>
<li><a href="#_verifying_brandname_cluster_discovery">1.4.2. Verifying {brandname} Cluster Discovery</a></li>
<li><a href="#_creating_caches">1.4.3. Creating Caches</a></li>
<li><a href="#_creating_entries">1.4.4. Creating Entries</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#server_configuring">2. Configuring {brandname} Servers</a>
<ul class="sectlevel2">
<li><a href="#server_config_jgroups">2.1. JGroups Subsystem Configuration</a>
<ul class="sectlevel3">
<li><a href="#_switching_jgroups_stacks">2.1.1. Switching JGroups Stacks</a></li>
<li><a href="#jgroups_tune_transport-server_configuring">2.1.2. Tuning Transport Protocols</a></li>
<li><a href="#default_jgroups_stacks-server_configuring">2.1.3. Default JGroups Stacks</a></li>
<li><a href="#_tcp_ping_discovery">2.1.4. TCP PING Discovery</a></li>
<li><a href="#_tcp_gossip_discovery">2.1.5. TCP Gossip Discovery</a></li>
<li><a href="#_aws_s3_ping">2.1.6. AWS S3 Ping</a></li>
<li><a href="#_google_ping">2.1.7. Google Ping</a></li>
<li><a href="#_dns_ping">2.1.8. DNS Ping</a></li>
</ul>
</li>
<li><a href="#_brandname_subsystem">2.2. {brandname} subsystem</a>
<ul class="sectlevel3">
<li><a href="#_containers">2.2.1. Containers</a></li>
<li><a href="#_cache_declarations">2.2.2. Cache declarations</a></li>
<li><a href="#_expiration">2.2.3. Expiration</a></li>
<li><a href="#_eviction">2.2.4. Eviction</a></li>
<li><a href="#_locking">2.2.5. Locking</a></li>
<li><a href="#_loaders_and_stores">2.2.6. Loaders and Stores</a></li>
<li><a href="#_state_transfer">2.2.7. State Transfer</a></li>
</ul>
</li>
<li><a href="#_endpoint_subsystem_configuration">2.3. Endpoint subsystem configuration</a>
<ul class="sectlevel3">
<li><a href="#_hot_rod">2.3.1. Hot Rod</a></li>
<li><a href="#_memcached">2.3.2. Memcached</a></li>
<li><a href="#_rest">2.3.3. REST</a></li>
<li><a href="#_common_protocol_connector_settings">2.3.4. Common Protocol Connector Settings</a></li>
</ul>
</li>
<li><a href="#_protocol_interoperability">2.4. Protocol Interoperability</a></li>
<li><a href="#_custom_marshaller_bridges">2.5. Custom Marshaller Bridges</a>
<ul class="sectlevel3">
<li><a href="#_protostuff">2.5.1. Protostuff</a></li>
<li><a href="#_kryo">2.5.2. Kryo</a></li>
<li><a href="#_storing_deserialized_objects">2.5.3. Storing deserialized objects</a></li>
<li><a href="#_registering_custom_schemasserializers">2.5.4. Registering Custom Schemas/Serializers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#server_scripts">3. Scripting</a>
<ul class="sectlevel2">
<li><a href="#_scripting">3.1. Scripting</a></li>
<li><a href="#_installing_scripts">3.2. Installing Scripts</a>
<ul class="sectlevel3">
<li><a href="#_script_metadata">3.2.1. Script Metadata</a></li>
</ul>
</li>
<li><a href="#_running_scripts_with_the_hot_rod_java_client">3.3. Running Scripts with the Hot Rod Java Client</a></li>
<li><a href="#_distributed_script_execution">3.4. Distributed Script Execution</a></li>
</ul>
</li>
<li><a href="#server_health">4. Monitoring Server Health</a>
<ul class="sectlevel2">
<li><a href="#_health_monitoring">4.1. Health Monitoring</a></li>
<li><a href="#_accessing_health_api_using_jmx">4.2. Accessing Health API using JMX</a></li>
<li><a href="#_accessing_health_api_using_cli">4.3. Accessing Health API using CLI</a></li>
<li><a href="#_accessing_health_api_using_rest">4.4. Accessing Health API using REST</a></li>
</ul>
</li>
<li><a href="#server_multitenancy">5. Multitenancy</a>
<ul class="sectlevel2">
<li><a href="#_multi_tenancy">5.1. Multi-tenancy</a></li>
<li><a href="#_multi_tenancy_with_rest">5.2. Multi-tenancy with REST</a></li>
<li><a href="#_multi_tenancy_with_hot_rod">5.3. Multi-tenancy with Hot Rod</a></li>
<li><a href="#_multi_tenant_router">5.4. Multi-tenant router</a></li>
</ul>
</li>
<li><a href="#security-{context}">6. Securing {brandname} Servers</a>
<ul class="sectlevel2">
<li><a href="#_security_concepts">6.1. Security Concepts</a>
<ul class="sectlevel3">
<li><a href="#_authorization">6.1.1. Authorization</a></li>
<li><a href="#_server_realms">6.1.2. Server Realms</a></li>
</ul>
</li>
<li><a href="#security_hotrod_auth">6.2. Hot Rod Authentication</a>
<ul class="sectlevel3">
<li><a href="#security_saslqop">6.2.1. SASL Quality of Protection</a></li>
<li><a href="#_sasl_policies">6.2.2. SASL Policies</a></li>
<li><a href="#_using_gssapikerberos">6.2.3. Using GSSAPI/Kerberos</a></li>
</ul>
</li>
<li><a href="#security_hotrod_rest_encryption">6.3. Hot Rod and REST encryption (TLS/SSL)</a></li>
</ul>
</li>
<li><a href="#monitoring-{context}">7. Monitoring {brandname} Servers</a>
<ul class="sectlevel2">
<li><a href="#server_access_logs">7.1. Access Logs</a>
<ul class="sectlevel3">
<li><a href="#server_access_logs_enable">7.1.1. Enabling Access Logs</a></li>
<li><a href="#server_access_logs_properties">7.1.2. Access Log Properties</a></li>
</ul>
</li>
<li><a href="#_monitoring_brandname_servers_over_jmx">7.2. Monitoring {brandname} Servers Over JMX</a>
<ul class="sectlevel3">
<li><a href="#jmx_mgmt_tooling">7.2.1. JMX Monitoring</a></li>
<li><a href="#_jmx_with_prometheus">7.2.2. JMX with Prometheus</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#server_single_port">8. Single Port</a>
<ul class="sectlevel2">
<li><a href="#_single_port_router">8.1. Single-Port router</a>
<ul class="sectlevel3">
<li><a href="#_testing_the_single_port_router">8.1.1. Testing the Single-Port router</a></li>
</ul>
</li>
<li><a href="#_hot_rod_protocol_detection">8.2. Hot Rod Protocol Detection</a>
<ul class="sectlevel3">
<li><a href="#_tlsalpn_protocol_selection">8.2.1. TLS/ALPN protocol selection</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#server_rolling_upgrade">9. Performing Rolling Upgrades</a>
<ul class="sectlevel2">
<li><a href="#_rolling_upgrades">9.1. Rolling Upgrades</a></li>
<li><a href="#_setting_up_target_clusters">9.2. Setting Up Target Clusters</a></li>
<li><a href="#_synchronizing_data_from_source_clusters">9.3. Synchronizing Data from Source Clusters</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>{brandname} server is a managed, distributed, and clusterable data grid that provides elastic scaling and high performance access to caches from multiple endpoints, such as Hot Rod and REST.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server_start">1. Getting Started with {brandname} Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quickly set up {brandname} server and learn the basics.</p>
</div>
<div class="sect2">
<h3 id="_brandname_server_requirements">1.1. {brandname} Server Requirements</h3>
<div class="paragraph">
<p>Check host system requirements for the {brandname} server.</p>
</div>
<div class="paragraph">
<p>{brandname} server requires a Java Virtual Machine and supports:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java 8</p>
</li>
<li>
<p>Java 11</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_downloading_server_distributions">1.2. Downloading Server Distributions</h3>
<div class="paragraph">
<p>The {brandname} server distribution is an archive of Java libraries (<code>JAR</code> files), configuration files, and a <code>data</code> directory.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Download the {brandname} {infinispanversion} server from <a href="{download_url}">{brandname} downloads</a>.</p>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Use the checksum to verify the integrity of your download.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the <code>sha1sum</code> command with the server download archive as the argument, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ sha1sum infinispan-server-${version}.zip</code></pre>
</div>
</div>
</li>
<li>
<p>Compare with the <code>SHA-1</code> checksum value on the {brandname} downloads page.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Reference</div>
<p><a href="https://github.com/infinispan/infinispan/blob/master/server/runtime/README.md">{brandname} Server README</a> describes the contents of the server distribution.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_brandname_server">1.3. Installing {brandname} Server</h3>
<div class="paragraph">
<p>Extract the {brandname} server archive to any directory on your host.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Use any extraction tool with the server archive, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ unzip infinispan-server-${version}.zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting directory is your <code>$ISPN_HOME</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="server_quickstart">1.4. Running {brandname} Servers</h3>
<div class="paragraph">
<p>Spin up {brandname} server instances that automatically form clusters. Learn
how to create cache definitions to store your data.</p>
</div>
<div class="sect3">
<h4 id="_starting_brandname_servers">1.4.1. Starting {brandname} Servers</h4>
<div class="paragraph">
<p>Launch {brandname} server with the startup script.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open a terminal in <code>$ISPN_HOME</code>.</p>
</li>
<li>
<p>Run the <code>server</code> script.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Linux</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ bin/server.sh</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Microsoft Windows</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>bin\server.bat</code></pre>
</div>
</div>
<div class="paragraph">
<p>The server gives you these messages when it starts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>INFO  [org.infinispan.SERVER] (main) ISPN080004: Protocol SINGLE_PORT listening
on 127.0.0.1:11222
INFO  [org.infinispan.SERVER] (main) ISPN080001: Infinispan Server ${version}
started in 7453ms</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>Hello {brandname}!</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open <code>127.0.0.1:11222</code> in any browser to see the {brandname} server welcome
message.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Reference</div>
<p><a href="https://github.com/infinispan/infinispan/blob/master/server/runtime/README.md">{brandname} Server README</a> describes command line
arguments for the <code>server</code> script.</p>
</div>
</div>
<div class="sect3">
<h4 id="_verifying_brandname_cluster_discovery">1.4.2. Verifying {brandname} Cluster Discovery</h4>
<div class="paragraph">
<p>{brandname} servers running on the same network discover each other with the <code>MPING</code> protocol.</p>
</div>
<div class="paragraph">
<p>This procedure shows you how to use {brandname} server command arguments to
start two instances on the same host and verify that the cluster view forms.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Start a {brandname} server.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install and run a new {brandname} server instance.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Open a terminal in <code>$ISPN_HOME</code>.</p>
</li>
<li>
<p>Copy the root directory to <code>server2</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ cp -r server server2</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Specify a port offset and the location of the <code>server2</code> root directory.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ bin/server.sh -o 100 -s server2</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Running servers return the following messages when new servers join clusters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>INFO  [org.infinispan.CLUSTER] (jgroups-11,&lt;server_hostname&gt;)
ISPN000094: Received new cluster view for channel cluster:
[&lt;server_hostname&gt;|3] (2) [&lt;server_hostname&gt;, &lt;server2_hostname&gt;]
INFO  [org.infinispan.CLUSTER] (jgroups-11,&lt;server_hostname&gt;)
ISPN100000: Node &lt;server2_hostname&gt; joined the cluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>Servers return the following messages when they join clusters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>INFO  [org.infinispan.remoting.transport.jgroups.JGroupsTransport] (main)
ISPN000078: Starting JGroups channel cluster
INFO  [org.infinispan.CLUSTER] (main)
ISPN000094: Received new cluster view for channel cluster:
[&lt;server_hostname&gt;|3] (2) [&lt;server_hostname&gt;, &lt;server2_hostname&gt;]</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Reference</div>
<p><a href="https://github.com/infinispan/infinispan/blob/master/server/runtime/README.md">{brandname} Server README</a> describes command line
arguments for the <code>server</code> script.</p>
</div>
</div>
<div class="sect3">
<h4 id="_creating_caches">1.4.3. Creating Caches</h4>
<div class="paragraph">
<p>The default cache container for {brandname} servers is empty. Before you can store data in your cluster, you must create a cache.</p>
</div>
<div class="paragraph">
<p>This procedure shows you how to get started with the default cache templates.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Start the {brandname} command line interface (CLI).</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Open a terminal in <code>$ISPN_HOME</code>.</p>
</li>
<li>
<p>Run the <code>cli</code> script.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ bin/cli.sh
[disconnected]&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Connect to the {brandname} cluster.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[disconnected]&gt; connect
[{server_hostname}@cluster//containers/default]&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create a distributed, synchronous cache from the template and name it "mycache".</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[//containers/default]&gt; create cache --template=org.infinispan.DIST_SYNC mycache</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Press the tab key after the <code>--template=</code> argument to list available cache templates.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>Navigate to the <code>caches</code> directory.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[//containers/default]&gt; cd caches</code></pre>
</div>
</div>
</li>
<li>
<p>Retrieve the cache configuration.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[//containers/default/caches]&gt; describe mycache
{
  "distributed-cache" : {
    "mode" : "SYNC",
    "remote-timeout" : 17500,
    "state-transfer" : {
      "timeout" : 60000
    },
    "transaction" : {
      "mode" : "NONE"
    },
    "locking" : {
      "concurrency-level" : 1000,
      "acquire-timeout" : 15000,
      "striping" : false
    }
  }
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_creating_entries">1.4.4. Creating Entries</h4>
<div class="paragraph">
<p>After you create a cache, use the CLI to add some data.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add a key/value pair to <code>mycache</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[//containers/default/caches]&gt; put --cache=mycache hello world</code></pre>
</div>
</div>
</li>
<li>
<p>Navigate into the cache.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[//containers/default/caches]&gt; cd mycache</code></pre>
</div>
</div>
</li>
<li>
<p>List keys.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[//containers/default/caches/mycache]&gt; ls
hello</code></pre>
</div>
</div>
</li>
<li>
<p>Get values for keys.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[//containers/default/caches/mycache]&gt; get hello
world</code></pre>
</div>
</div>
</li>
<li>
<p>Disconnect and quit.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[//containers/default/caches/mycache]&gt; disconnect
[disconnected]&gt; quit</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server_configuring">2. Configuring {brandname} Servers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="server_config_jgroups">2.1. JGroups Subsystem Configuration</h3>
<div class="paragraph">
<p>The JGroups subsystem configures the network transport and is only required when clustering multiple {brandname} Server nodes together.</p>
</div>
<div class="paragraph">
<p>The subsystem declaration is enclosed in the following XML element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;subsystem xmlns="urn:infinispan:server:jgroups:9.2"&gt;
  &lt;channels default="cluster"&gt;
    &lt;channel name="cluster"/&gt;
  &lt;/channels&gt;
  &lt;stacks default="${jboss.default.jgroups.stack:udp}"&gt;
    ...
  &lt;/stacks&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the subsystem, you need to declare the stacks that you wish to use and name them. The default-stack attribute in the subsystem declaration must point to one of the declared stacks.</p>
</div>
<div class="sect3">
<h4 id="_switching_jgroups_stacks">2.1.1. Switching JGroups Stacks</h4>
<div class="paragraph">
<p>You can switch stacks from the command-line using the jboss.default.jgroups.stack property:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>bin/standalone.sh -c clustered.xml -Djboss.default.jgroups.stack=tcp</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jgroups_tune_transport-server_configuring">2.1.2. Tuning Transport Protocols</h4>
<div class="paragraph">
<p>A stack declaration is composed of a transport, <code>UDP</code> or <code>TCP</code>, followed by a list of protocols. You can tune protocols by adding properties as child elements with this format:</p>
</div>
<div class="paragraph">
<p><code>&lt;property name="prop_name"&gt;prop_value&lt;/property&gt;</code></p>
</div>
</div>
<div class="sect3">
<h4 id="default_jgroups_stacks-server_configuring">2.1.3. Default JGroups Stacks</h4>
<div class="paragraph">
<p>{brandname} uses the following JGroups <code>TCP</code> and <code>UDP</code> stacks by default:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;stack name="udp"&gt;
  &lt;transport type="UDP" socket-binding="jgroups-udp"/&gt;
  &lt;protocol type="PING"/&gt;
  &lt;protocol type="MERGE3"/&gt;
  &lt;protocol type="FD_SOCK" socket-binding="jgroups-udp-fd"/&gt;
  &lt;protocol type="FD_ALL"/&gt;
  &lt;protocol type="VERIFY_SUSPECT"/&gt;
  &lt;protocol type="pbcast.NAKACK2"/&gt;
  &lt;protocol type="UNICAST3"/&gt;
  &lt;protocol type="pbcast.STABLE"/&gt;
  &lt;protocol type="pbcast.GMS"/&gt;
  &lt;protocol type="UFC_NB"/&gt;
  &lt;protocol type="MFC_NB"/&gt;
  &lt;protocol type="FRAG3"/&gt;
&lt;/stack&gt;
&lt;stack name="tcp"&gt;
  &lt;transport type="TCP" socket-binding="jgroups-tcp"/&gt;
  &lt;protocol type="MPING" socket-binding="jgroups-mping"/&gt;
  &lt;protocol type="MERGE3"/&gt;
  &lt;protocol type="FD_SOCK" socket-binding="jgroups-tcp-fd"/&gt;
  &lt;protocol type="FD_ALL"/&gt;
  &lt;protocol type="VERIFY_SUSPECT"/&gt;
  &lt;protocol type="pbcast.NAKACK2"&gt;
    &lt;property name="use_mcast_xmit"&gt;false&lt;/property&gt;
  &lt;/protocol&gt;
  &lt;protocol type="UNICAST3"/&gt;
  &lt;protocol type="pbcast.STABLE"/&gt;
  &lt;protocol type="pbcast.GMS"/&gt;
  &lt;protocol type="MFC_NB"/&gt;
  &lt;protocol type="FRAG3"/&gt;
&lt;/stack&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To improve performance, {brandname} uses some values for properties other than the JGroups default values. You should examine the following files to review the JGroups configuration for {brandname}:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>{brandname} servers</p>
<div class="ulist">
<ul>
<li>
<p><code>jgroups-defaults.xml</code></p>
</li>
<li>
<p><code>infinispan-jgroups.xml</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Embedded {brandname}</p>
<div class="ulist">
<ul>
<li>
<p><code>default-jgroups-tcp.xml</code></p>
</li>
<li>
<p><code>default-jgroups-udp.xml</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The default <code>TCP</code> stack uses the <code>MPING</code> protocol for discovery, which uses
<code>UDP</code> multicast.</p>
</div>
<div class="ulist">
<div class="title">Reference</div>
<ul>
<li>
<p><a href="http://www.jgroups.org/manual/html/protlist.html">JGroups Protocol</a></p>
</li>
<li>
<p><a href="http://www.jgroups.org/manual/html/protlist.html#DiscoveryProtocols">JGroups Discovery Protocols</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_tcp_ping_discovery">2.1.4. TCP PING Discovery</h4>
<div class="paragraph">
<p>The following example stack configures the TCPPING discovery protocol with two initial hosts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;stack name="tcp"&gt;
  &lt;transport type="TCP" socket-binding="jgroups-tcp"/&gt;
  &lt;protocol type="TCPPING"&gt;
    &lt;property name="initial_hosts"&gt;HostA[7800],HostB[7800]&lt;/property&gt;
  &lt;/protocol&gt;
  &lt;protocol type="MERGE3"/&gt;
  &lt;protocol type="FD_SOCK" socket-binding="jgroups-tcp-fd"/&gt;
  &lt;protocol type="FD_ALL"/&gt;
  &lt;protocol type="VERIFY_SUSPECT"/&gt;
  &lt;protocol type="pbcast.NAKACK2"&gt;
    &lt;property name="use_mcast_xmit"&gt;false&lt;/property&gt;
  &lt;/protocol&gt;
  &lt;protocol type="UNICAST3"/&gt;
  &lt;protocol type="pbcast.STABLE"/&gt;
  &lt;protocol type="pbcast.GMS"/&gt;
  &lt;protocol type="UFC_NB"/&gt;
  &lt;protocol type="MFC_NB"/&gt;
  &lt;protocol type="FRAG3"/&gt;
&lt;/stack&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tcp_gossip_discovery">2.1.5. TCP Gossip Discovery</h4>
<div class="paragraph">
<p>The default configurations come with a variety of pre-configured stacks for different environments. For example, the tcpgossip stack uses Gossip discovery:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;protocol type="TCPGOSSIP"&gt;
  &lt;property name="initial_hosts"&gt;${jgroups.gossip.initial_hosts:}&lt;/property&gt;
&lt;/protocol&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_aws_s3_ping">2.1.6. AWS S3 Ping</h4>
<div class="paragraph">
<p>Use the s3 stack when running in Amazon AWS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;protocol type="org.jgroups.aws.s3.NATIVE_S3_PING" module="org.jgroups.aws.s3:{infinispanslot}"&gt;
  &lt;property name="region_name"&gt;${jgroups.s3.region:}&lt;/property&gt;
  &lt;property name="bucket_name"&gt;${jgroups.s3.bucket_name:}&lt;/property&gt;
  &lt;property name="bucket_prefix"&gt;${jgroups.s3.bucket_prefix:}&lt;/property&gt;
&lt;/protocol&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_google_ping">2.1.7. Google Ping</h4>
<div class="paragraph">
<p>Similarly, when using Google&#8217;s Cloud Platform, use the google stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;protocol type="GOOGLE_PING"&gt;
  &lt;property name="location"&gt;${jgroups.google.bucket:}&lt;/property&gt;
  &lt;property name="access_key"&gt;${jgroups.google.access_key:}&lt;/property&gt;
  &lt;property name="secret_access_key"&gt;${jgroups.google.secret_access_key:}&lt;/property&gt;
&lt;/protocol&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dns_ping">2.1.8. DNS Ping</h4>
<div class="paragraph">
<p>Use the dns-ping stack to run {brandname} on Kubernetes environments such as OKD or OpenShift:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;protocol type="dns.DNS_PING"&gt;
    &lt;property name="dns_query"&gt;${jgroups.dns_ping.dns_query}&lt;/property&gt;
&lt;/protocol&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of the <code>dns_query</code> property is the DNS query that returns the cluster members. See <a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/">DNS for Services and Pods</a> for information about Kubernetes DNS naming.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_brandname_subsystem">2.2. {brandname} subsystem</h3>
<div class="paragraph">
<p>The {brandname} subsystem configures the cache containers and caches.</p>
</div>
<div class="paragraph">
<p>The subsystem declaration is enclosed in the following XML element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;subsystem xmlns="urn:infinispan:server:core:9.4" default-cache-container="clustered"&gt;
  ...
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_containers">2.2.1. Containers</h4>
<div class="paragraph">
<p>The {brandname} subsystem can declare multiple containers. A container is declared as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;cache-container name="clustered" default-cache="default"&gt;
  ...
&lt;/cache-container&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>{brandname} does not provide an implicit default cache, but lets you name a cache as the default.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you need to declare clustered caches (distributed, replicated, invalidation), you also need to specify the <code>&lt;transport/&gt;</code> element which references an existing JGroups transport. This is not needed if you only intend to have local caches only.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;transport executor="infinispan-transport" lock-timeout="60000" stack="udp" cluster="my-cluster-name"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cache_declarations">2.2.2. Cache declarations</h4>
<div class="paragraph">
<p>Now you can declare your caches. Please be aware that only the caches declared in the configuration will be available to the endpoints and that attempting to access an undefined cache is an illegal operation. Contrast this with the default {brandname} library behaviour where obtaining an undefined cache will implicitly create one using the default settings. The following are example declarations for all four available types of caches:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;local-cache name="default" start="EAGER"&gt;
  ...
&lt;/local-cache&gt;

&lt;replicated-cache name="replcache" mode="SYNC" remote-timeout="30000" start="EAGER"&gt;
  ...
&lt;/replicated-cache&gt;

&lt;invalidation-cache name="invcache" mode="SYNC" remote-timeout="30000" start="EAGER"&gt;
  ...
&lt;/invalidation-cache&gt;

&lt;distributed-cache name="distcache" mode="SYNC" segments="20" owners="2" remote-timeout="30000" start="EAGER"&gt;
  ...
&lt;/distributed-cache&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_expiration">2.2.3. Expiration</h4>
<div class="paragraph">
<p>To define a default expiration for entries in a cache, add the <code>&lt;expiration/&gt;</code> element as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;expiration lifespan="2000" max-idle="1000"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The possible attributes for the expiration element are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>lifespan</em> maximum lifespan of a cache entry, after which the entry is expired cluster-wide, in milliseconds. -1 means the entries never expire.</p>
</li>
<li>
<p><em>max-idle</em> maximum idle time a cache entry will be maintained in the cache, in milliseconds. If the idle time is exceeded, the entry will be expired cluster-wide. -1 means the entries never expire.</p>
</li>
<li>
<p><em>interval</em> interval (in milliseconds) between subsequent runs to purge expired entries from memory and any cache stores. If you wish to disable the periodic eviction process altogether, set interval to -1.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_eviction">2.2.4. Eviction</h4>
<div class="paragraph">
<p>To define eviction for a cache, add the <code>&lt;memory/&gt;</code> element as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;memory&gt;
  &lt;binary size="1000" eviction="COUNT"/&gt;
&lt;/memory&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The possible attributes for the eviction element are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>strategy</em> sets the cache eviction strategy. Available options are 'UNORDERED', 'FIFO', 'LRU', 'LIRS' and 'NONE' (to disable eviction).</p>
</li>
<li>
<p><em>max-entries</em> maximum number of entries in a cache instance. If selected value is not a power of two the actual value will default to the least power of two larger than selected value. -1 means no limit.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_locking">2.2.5. Locking</h4>
<div class="paragraph">
<p>To define the locking configuration for a cache, add the <code>&lt;locking/&gt;</code> element as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;locking isolation="REPEATABLE_READ" acquire-timeout="30000" concurrency-level="1000" striping="false"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The possible attributes for the locking element are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>isolation</em> sets the cache locking isolation level. Can be NONE, READ_UNCOMMITTED, READ_COMMITTED, REPEATABLE_READ, SERIALIZABLE. Defaults to REPEATABLE_READ</p>
</li>
<li>
<p><em>striping</em> if true, a pool of shared locks is maintained for all entries that need to be locked. Otherwise, a lock is created per entry in the cache. Lock striping helps control memory footprint but may reduce concurrency in the system.</p>
</li>
<li>
<p><em>acquire-timeout</em> maximum time to attempt a particular lock acquisition.</p>
</li>
<li>
<p><em>concurrency-level</em> concurrency level for lock containers. Adjust this value according to the number of concurrent threads interacting with {brandname}.</p>
</li>
<li>
<p><em>concurrent-updates</em> for non-transactional caches only: if set to true(default value) the cache keeps data consistent in the case of concurrent updates. For clustered caches this comes at the cost of an additional RPC, so if you don&#8217;t expect your application to write data concurrently, disabling this flag increases performance.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_loaders_and_stores">2.2.6. Loaders and Stores</h4>
<div class="paragraph">
<p>Loaders and stores can be defined in server mode in almost the same way as in embedded mode.</p>
</div>
<div class="paragraph">
<p>However, in server mode it is no longer necessary to define the <code>&lt;persistence&gt;&#8230;&#8203;&lt;/persistence&gt;</code> tag. Instead, a store&#8217;s attributes are
now defined on the store type element. For example, to configure the H2 database with a distributed cache in domain mode
we define the "default" cache as follows in our domain.xml configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;subsystem xmlns="urn:infinispan:server:core:9.4"&gt;
  &lt;cache-container name="clustered" default-cache="default" statistics="true"&gt;
    &lt;transport lock-timeout="60000"/&gt;
    &lt;global-state/&gt;
    &lt;distributed-cache name="default"&gt;
      &lt;string-keyed-jdbc-store datasource="java:jboss/datasources/ExampleDS" fetch-state="true" shared="true"&gt;
        &lt;string-keyed-table prefix="ISPN"&gt;
          &lt;id-column name="id" type="VARCHAR"/&gt;
          &lt;data-column name="datum" type="BINARY"/&gt;
          &lt;timestamp-column name="version" type="BIGINT"/&gt;
        &lt;/string-keyed-table&gt;
        &lt;write-behind modification-queue-size="20"/&gt;
      &lt;/string-keyed-jdbc-store&gt;
    &lt;/distributed-cache&gt;
  &lt;/cache-container&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another important thing to note in this example, is that we use the "ExampleDS" datasource which is defined in the datasources
subsystem in our domain.xml configuration as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:datasources:4.0"&gt;
  &lt;datasources&gt;
    &lt;datasource jndi-name="java:jboss/datasources/ExampleDS" pool-name="ExampleDS" enabled="true" use-java-context="true"&gt;
      &lt;connection-url&gt;jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE&lt;/connection-url&gt;
      &lt;driver&gt;h2&lt;/driver&gt;
      &lt;security&gt;
        &lt;user-name&gt;sa&lt;/user-name&gt;
        &lt;password&gt;sa&lt;/password&gt;
      &lt;/security&gt;
    &lt;/datasource&gt;
  &lt;/datasources&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For additional examples of store configurations, please view the configuration templates in the default "domain.xml" file
provided with in the server distribution at <code>./domain/configuration/domain.xml</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_state_transfer">2.2.7. State Transfer</h4>
<div class="paragraph">
<p>To define the state transfer configuration for a distributed or replicated cache, add the <code>&lt;state-transfer/&gt;</code> element as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;state-transfer enabled="true" timeout="240000" chunk-size="512" await-initial-transfer="true" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The possible attributes for the state-transfer element are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>enabled</em> if true, this will cause the cache to ask neighboring caches for state when it starts up, so the cache starts 'warm', although it will impact startup time. Defaults to true.</p>
</li>
<li>
<p><em>timeout</em> the maximum amount of time (ms) to wait for state from neighboring caches, before throwing an exception and aborting startup. Defaults to 240000 (4 minutes).</p>
</li>
<li>
<p><em>chunk-size</em> the number of cache entries to batch in each transfer. Defaults to 512.</p>
</li>
<li>
<p><em>await-initial-transfer</em> if true, this will cause the cache to wait for initial state transfer to complete before responding to requests. Defaults to true.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_endpoint_subsystem_configuration">2.3. Endpoint subsystem configuration</h3>
<div class="paragraph">
<p>The endpoint subsystem exposes a whole container (or in the case of Memcached, a single cache) over a specific connector protocol. You can define as many connector as you need, provided they bind on different interfaces/ports.</p>
</div>
<div class="paragraph">
<p>The subsystem declaration is enclosed in the following XML element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;subsystem xmlns="urn:infinispan:server:endpoint:9.4"&gt;
 ...
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_hot_rod">2.3.1. Hot Rod</h4>
<div class="paragraph">
<p>The following connector declaration enables a HotRod server using the <em>hotrod</em> socket binding (declared within a <code>&lt;socket-binding-group /&gt;</code> element) and exposing the caches declared in the <em>local</em> container, using defaults for all other settings.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;hotrod-connector socket-binding="hotrod" cache-container="local" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The connector will create a supporting topology cache with default settings. If you wish to tune these settings add the <code>&lt;topology-state-transfer /&gt;</code> child element to the connector as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;hotrod-connector socket-binding="hotrod" cache-container="local"&gt;
   &lt;topology-state-transfer lazy-retrieval="false" lock-timeout="1000" replication-timeout="5000" /&gt;
&lt;/hotrod-connector&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Hot Rod connector can be further tuned with additional settings such as concurrency and buffering. See the protocol connector settings paragraph for additional details</p>
</div>
<div class="paragraph">
<p>Furthermore the HotRod connector can be secured using SSL. First you need to declare an SSL server identity within a security realm in the management section of the configuration file. The SSL server identity should specify the path to a keystore and its secret. Refer to the AS <a href="{wildflydocroot}/Security%20Realms">documentation</a> on this. Next add the <code>&lt;security /&gt;</code> element to the HotRod connector as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;hotrod-connector socket-binding="hotrod" cache-container="local"&gt;
    &lt;security ssl="true" security-realm="ApplicationRealm" require-ssl-client-auth="false" /&gt;
&lt;/hotrod-connector&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_memcached">2.3.2. Memcached</h4>
<div class="paragraph">
<p>The following connector declaration enables a Memcached server using the <em>memcached</em> socket binding (declared within a <code>&lt;socket-binding-group /&gt;</code> element) and exposing the <em>memcachedCache</em> cache declared in the <em>local</em> container, using defaults for all other settings. Because of limitations in the Memcached protocol, only one cache can be exposed by a connector. If you wish to expose more than one cache, declare additional memcached-connectors on different socket-bindings.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;memcached-connector socket-binding="memcached" cache-container="local"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rest">2.3.3. REST</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;rest-connector socket-binding="rest" cache-container="local" security-domain="other" auth-method="BASIC"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_common_protocol_connector_settings">2.3.4. Common Protocol Connector Settings</h4>
<div class="paragraph">
<p>The HotRod and Memcached protocol connectors support a number of tuning attributes in their declaration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>worker-threads</em> Sets the number of worker threads. Defaults to 160.</p>
</li>
<li>
<p><em>idle-timeout</em> Specifies the maximum time in seconds that connections from client will be kept open without activity. Defaults to -1 (connections will never timeout)</p>
</li>
<li>
<p><em>tcp-nodelay</em> Affects TCP NODELAY on the TCP stack. Defaults to enabled.</p>
</li>
<li>
<p><em>send-buffer-size</em> Sets the size of the send buffer.</p>
</li>
<li>
<p><em>receive-buffer-size</em> Sets the size of the receive buffer.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_protocol_interoperability">2.4. Protocol Interoperability</h3>
<div class="paragraph">
<p>Clients exchange data with {brandname} through endpoints such as REST or Hot Rod.</p>
</div>
<div class="paragraph">
<p>Each endpoint uses a different protocol so that clients can read and write data in a suitable format. Because {brandname} can interoperate with multiple clients at the same time, it must convert data between client formats and the storage formats.</p>
</div>
</div>
<div class="sect2">
<h3 id="_custom_marshaller_bridges">2.5. Custom Marshaller Bridges</h3>
<div class="paragraph">
<p>{brandname} provides two marshalling bridges for marshalling client/server requests using the Kryo and Protostuff libraries.
To utilise either of these marshallers, you simply place the dependency of the marshaller you require in your client
pom. Custom schemas for object marshalling must then be registered with the selected library using the library&#8217;s api on
the client or by implementing a RegistryService for the given marshaller bridge. Examples of how to achieve this for both
libraries are presented below:</p>
</div>
<div class="sect3">
<h4 id="_protostuff">2.5.1. Protostuff</h4>
<div class="paragraph">
<p>Add the protostuff marshaller dependency to your pom:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.infinispan&lt;/groupId&gt;
  &lt;artifactId&gt;infinispan-marshaller-protostuff&lt;/artifactId&gt;
  &lt;!-- Replace ${version.infinispan} with the
  version of {brandname} that you're using. --&gt;
  &lt;version&gt;${version.infinispan}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To register custom Protostuff schemas in your own code, you must register the custom schema with Protostuff before any
marshalling begins. This can be achieved by simply calling:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">RuntimeSchema.register(ExampleObject.class, new ExampleObjectSchema());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, you can implement a service provider for the <code>SchemaRegistryService.java</code> interface, placing all Schema registrations
in the <code>register()</code> method.  Implementations of this interface are loaded via Java&#8217;s ServiceLoader api, therefore the full path
of the implementing class(es) should be provided in a <code>META-INF/services/org/infinispan/marshaller/protostuff/SchemaRegistryService</code>
file within your deployment jar.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kryo">2.5.2. Kryo</h4>
<div class="paragraph">
<p>Add the kryo marshaller dependency to your pom:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.infinispan&lt;/groupId&gt;
  &lt;artifactId&gt;infinispan-marshaller-kryo&lt;/artifactId&gt;
  &lt;!-- Replace ${version.infinispan} with the
  version of {brandname} that you're using. --&gt;
  &lt;version&gt;${version.infinispan}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To register custom Kryo serializer in your own code, you must register the custom serializer with Kryo before any
marshalling begins. This can be achieved by implementing a service provider for the <code>SerializerRegistryService.java</code> interface, placing all serializer registrations
in the <code>register(Kryo)</code> method; where serializers should be registered with the supplied <code>Kryo</code> object using the Kryo api.
e.g. <code>kryo.register(ExampleObject.class, new ExampleObjectSerializer())</code>.  Implementations of this interface are loaded
via Java&#8217;s ServiceLoader api, therefore the full path of the implementing class(es) should be provided in a
<code>META-INF/services/org/infinispan/marshaller/kryo/SerializerRegistryService</code> file within your deployment jar.</p>
</div>
</div>
<div class="sect3">
<h4 id="_storing_deserialized_objects">2.5.3. Storing deserialized objects</h4>
<div class="paragraph">
<p>When using the Protostuff/Kryo bridges in caches configured with <em>application/x-java-object</em> as MediaType (storing POJOs instead of binary content) it is necessary for the class files of all custom objects to
be placed on the classpath of the server.  To achieve this, you should place a jar containing all of their custom classes on the server&#8217;s classpath.</p>
</div>
<div class="paragraph">
<p>When utilising a custom marshaller, it is also necessary for the marshaller and it&#8217;s runtime dependencies
to be on the server&#8217;s classpath.  To aid with this step we have created a "bundle" jar for each of the bridge implementations
which includes all of the runtime class files required by the bridge and underlying library. Therefore, it is only
necessary to include this single jar on the server&#8217;s classpath.</p>
</div>
<div class="paragraph">
<p>Bundle jar downloads:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://central.maven.org/maven2/org/infinispan/infinispan-marshaller-kryo-bundle/{infinispanversion}/infinispan-marshaller-kryo-bundle-{infinispanversion}.jar">Kryo Bundle</a></p>
</li>
<li>
<p><a href="http://central.maven.org/maven2/org/infinispan/infinispan-marshaller-protostuff-bundle/{infinispanversion}/infinispan-marshaller-protostuff-bundle-{infinispanversion}.jar">Protostuff Bundle</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Jar files containing custom classes must be placed in the same module/directory as the custom marshaller bundle so
that the marshaller can load them. i.e. if you register the marshaller bundle in <code>modules/system/layers/base/org/infinispan/main/modules.xml</code>,
then you must also register your custom classes here.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_registering_custom_schemasserializers">2.5.4. Registering Custom Schemas/Serializers</h4>
<div class="paragraph">
<p>Custom serializers/schemas for the Kryo/Protostuff marshallers must be
registered via their respective service interfaces in order to store deserialized objects.
To achieve this, it is necessary for a <strong>JAR</strong> that contains the service provider to
be registered in the same directory or module as the marshaller bundle and
custom classes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is not necessary for the service provider implementation to be provided in
the same <strong>JAR</strong> as the user&#8217;s custom classes. However, the <strong>JAR</strong> that contains
the provider must be in the same directory/module as the marshaller and custom
class <strong>JAR</strong> files.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server_scripts">3. Scripting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_scripting">3.1. Scripting</h3>
<div class="paragraph">
<p>Scripting is a feature of {brandname} Server which allows invoking server-side scripts from remote clients.
Scripting leverages the JDK&#8217;s javax.script ScriptEngines, therefore allowing the use of any JVM languages which offer one.
By default, the JDK comes with Nashorn, a ScriptEngine capable of running JavaScript.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_scripts">3.2. Installing Scripts</h3>
<div class="paragraph">
<p>Scripts are stored in a special script cache, named '___script_cache'.
Adding a script is therefore as simple as put+ting it into the cache itself.
If the name of the script contains a filename extension, e.g. +myscript.js, then that extension determines the engine that
will be used to execute it.
Alternatively the script engine can be selected using script metadata (see below).
Be aware that, when security is enabled, access to the script cache via the remote protocols requires
that the user belongs to the '___script_manager' role.</p>
</div>
<div class="sect3">
<h4 id="_script_metadata">3.2.1. Script Metadata</h4>
<div class="paragraph">
<p>Script metadata is additional information about the script that the user can provide to the server to affect how a
script is executed.
It is contained in a specially-formatted comment on the first lines of the script.</p>
</div>
<div class="sect4">
<h5 id="_script_metadata_comments">Script Metadata Comments</h5>
<div class="paragraph">
<p>Properties are specified as key=value pairs, separated by commas.
You can use several different comment styles: The <code>//</code>, <code>;;</code>, <code>#</code> depending on the scripting language you use.
You can split metadata over multiple lines if necessary, and you can use single (') or double (") quotes to delimit your values.</p>
</div>
<div class="paragraph">
<p>The following are examples of valid metadata comments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// name=test, language=javascript
// mode=local, parameters=[a,b,c]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_metadata_properties">Metadata Properties</h5>
<div class="paragraph">
<p>The following metadata property keys are available</p>
</div>
<div class="ulist">
<ul>
<li>
<p>mode: defines the mode of execution of a script. Can be one of the following values:</p>
<div class="ulist">
<ul>
<li>
<p>local: the script will be executed only by the node handling the request. The script itself however can invoke clustered operations</p>
</li>
<li>
<p>distributed: runs the script using the Distributed Executor Service</p>
</li>
</ul>
</div>
</li>
<li>
<p>language: defines the script engine that will be used to execute the script, e.g. Javascript</p>
</li>
<li>
<p>extension: an alternative method of specifying the script engine that will be used to execute the script, e.g. js</p>
</li>
<li>
<p>role: a specific role which is required to execute the script</p>
</li>
<li>
<p>parameters: an array of valid parameter names for this script. Invocations which specify parameter names not included in this list will cause an exception.</p>
</li>
<li>
<p>datatype: optional property providing information, in the form of
Media Types (also known as MIME) about the type of the data stored in the
caches, as well as parameter and return values. Currently it only accepts a
single value which is <code>text/plain; charset=utf-8</code>, indicating that data is
String UTF-8 format. This metadata parameter is designed for remote clients
that only support a particular type of data, making it easy for them to
retrieve, store and work with parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since the execution mode is a characteristic of the script, nothing special needs to be done on the client to invoke scripts in different modes.</p>
</div>
</div>
<div class="sect4">
<h5 id="_script_bindings">Script Bindings</h5>
<div class="paragraph">
<p>The script engine within {brandname} exposes several internal objects as bindings in the scope of the script execution.
These are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cache: the cache against which the script is being executed</p>
</li>
<li>
<p>marshaller: the marshaller to use for marshalling/unmarshalling data to the cache</p>
</li>
<li>
<p>cacheManager: the cacheManager for the cache</p>
</li>
<li>
<p>scriptingManager: the instance of the script manager which is being used to run the script. This can be used to run other scripts from a script.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_script_parameters">Script Parameters</h5>
<div class="paragraph">
<p>Aside from the standard bindings described above, when a script is executed it can be passed a set of named parameters which also appear as bindings.
Parameters are passed as name,value pairs where name is a string and value can be any value that is understood by the marshaller in use.</p>
</div>
<div class="paragraph">
<p>The following is an example of a JavaScript script which takes two parameters, multiplicand and multiplier and multiplies them.
Because the last operation is an expression evaluation, its result is returned to the invoker.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// mode=local,language=javascript
multiplicand * multiplier</code></pre>
</div>
</div>
<div class="paragraph">
<p>To store the script in the script cache, use the following Hot Rod code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">RemoteCache&lt;String, String&gt; scriptCache = cacheManager.getCache("___script_cache");
scriptCache.put("multiplication.js",
  "// mode=local,language=javascript\n" +
  "multiplicand * multiplier\n");</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_scripts_with_the_hot_rod_java_client">3.3. Running Scripts with the Hot Rod Java Client</h3>
<div class="paragraph">
<p>The following example shows how to invoke the above script by passing two named parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">RemoteCache&lt;String, Integer&gt; cache = cacheManager.getCache();
// Create the parameters for script execution
Map&lt;String, Object&gt; params = new HashMap&lt;&gt;();
params.put("multiplicand", 10);
params.put("multiplier", 20);
// Run the script on the server, passing in the parameters
Object result = cache.execute("multiplication.js", params);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_distributed_script_execution">3.4. Distributed Script Execution</h3>
<div class="paragraph">
<p>The following is a script which runs on all nodes.
Each node will return its address, and the results from all nodes will be collected in a List and returned to the client.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// mode:distributed,language=javascript
cacheManager.getAddress().toString();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server_health">4. Monitoring Server Health</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_health_monitoring">4.1. Health Monitoring</h3>
<div class="paragraph">
<p>{brandname} server has special endpoints for monitoring cluster health. The API is exposed via:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Programmatically (using <code>embeddedCacheManager.getHealth()</code>)</p>
</li>
<li>
<p>JMX</p>
</li>
<li>
<p>CLI</p>
</li>
<li>
<p>REST (using <a href="https://docs.jboss.org/author/display/WFLY10/The+HTTP+management+API">WildFly HTTP Management API</a>)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_accessing_health_api_using_jmx">4.2. Accessing Health API using JMX</h3>
<div class="paragraph">
<p>At first you need to connect to the {brandname} Server using JMX (use JConsole or other tool for this).
Next, navigate to object name <code>jboss.datagrid-infinispan:type=CacheManager,name="clustered",component=CacheContainerHealth</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_accessing_health_api_using_cli">4.3. Accessing Health API using CLI</h3>
<div class="paragraph">
<p>You can access the Health API from the Command Line Interface (CLI), as in the following examples:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Standalone</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ bin/cli.sh -c "/subsystem=datagrid-infinispan/cache-container=clustered/health=HEALTH:read-resource(include-runtime=true)"</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Domain Mode</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ bin/cli.sh -c "/host=master/server=${servername}/subsystem=datagrid-infinispan/cache-container=clustered/health=HEALTH:read-resource(include-runtime=true)"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>${servername}</code> is the name of the {brandname} server instance.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following is a sample result for the CLI invocation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "cache-health" =&gt; "HEALTHY",
        "cluster-health" =&gt; ["test"],
        "cluster-name" =&gt; "clustered",
        "free-memory" =&gt; 99958L,
        "log-tail" =&gt; [
            "&lt;time_stamp&gt; INFO  [org.infinispan.server.endpoint] (MSC service thread 1-5) DGENDPT10001: HotRodServer listening on 127.0.0.1:11222",
            "&lt;time_stamp&gt; INFO  [org.infinispan.server.endpoint] (MSC service thread 1-1) DGENDPT10001: MemcachedServer listening on 127.0.0.1:11211",
            "&lt;time_stamp&gt; INFO  [org.jboss.as.clustering.infinispan] (MSC service thread 1-6) DGISPN0001: Started ___protobuf_metadata cache from clustered container",
            "&lt;time_stamp&gt; INFO  [org.jboss.as.clustering.infinispan] (MSC service thread 1-6) DGISPN0001: Started ___script_cache cache from clustered container",
            "&lt;time_stamp&gt; INFO  [org.jboss.as.clustering.infinispan] (MSC service thread 1-5) DGISPN0001: Started ___hotRodTopologyCache cache from clustered container",
            "&lt;time_stamp&gt; INFO  [org.infinispan.rest.NettyRestServer] (MSC service thread 1-6) ISPN012003: REST server starting, listening on 127.0.0.1:8080",
            "&lt;time_stamp&gt; INFO  [org.infinispan.server.endpoint] (MSC service thread 1-6) DGENDPT10002: REST mapped to /rest",
            "&lt;time_stamp&gt; INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:9990/management",
            "&lt;time_stamp&gt; INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://127.0.0.1:9990",
            "&lt;time_stamp&gt; INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: {brandname} Server &lt;build_version&gt; (WildFly Core &lt;build_version&gt;) started in 8681ms - Started 196 of 237 services (121 services are lazy, passive or on-demand)"
        ],
        "number-of-cpus" =&gt; 8,
        "number-of-nodes" =&gt; 1,
        "total-memory" =&gt; 235520L
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_accessing_health_api_using_rest">4.4. Accessing Health API using REST</h3>
<div class="paragraph">
<p>The REST interface lets you access the same set of resources as the CLI. However, the HTTP Management API requires authentication so you must first add credentials with the <code>add-user.sh</code> script.</p>
</div>
<div class="paragraph">
<p>After you set up credentials, access the Health API via REST as in the following examples:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Standalone</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ curl --digest -L -D - "http://localhost:9990/management/subsystem/datagrid-infinispan/cache-container/clustered/health/HEALTH?operation=resource&amp;include-runtime=true&amp;json.pretty=1" --header "Content-Type: application/json" -u username:password</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Domain Mode</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ curl --digest -L -D - "http://localhost:9990/management/host/master/server/${servername}/subsystem/datagrid-infinispan/cache-container/clustered/health/HEALTH?operation=resource&amp;include-runtime=true&amp;json.pretty=1" --header "Content-Type: application/json" -u username:password</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>${servername}</code> is the name of the {brandname} server instance.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following is a sample result for the REST invocation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>HTTP/1.1 200 OK
Connection: keep-alive
Authentication-Info: nextnonce="AuZzFxz7uC4NMTQ3MDgyNTU1NTQ3OCfIJBHXVpPHPBdzGUy7Qts=",qop="auth",rspauth="b518c3170e627bd732055c382ce5d970",cnonce="NGViOWM0NDY5OGJmNjY0MjcyOWE4NDkyZDU3YzNhYjY=",nc=00000001
Content-Type: application/json; charset=utf-8
Content-Length: 1927
Date: &lt;time_stamp&gt;

{
    "cache-health" : "HEALTHY",
    "cluster-health" : ["test", "HEALTHY"],
    "cluster-name" : "clustered",
    "free-memory" : 96778,
    "log-tail" : [
        "&lt;time_stamp&gt; INFO  [org.infinispan.server.endpoint] (MSC service thread 1-5) DGENDPT10001: HotRodServer listening on 127.0.0.1:11222",
        "&lt;time_stamp&gt; INFO  [org.infinispan.server.endpoint] (MSC service thread 1-1) DGENDPT10001: MemcachedServer listening on 127.0.0.1:11211",
        "&lt;time_stamp&gt; INFO  [org.jboss.as.clustering.infinispan] (MSC service thread 1-6) DGISPN0001: Started ___protobuf_metadata cache from clustered container",
        "&lt;time_stamp&gt; INFO  [org.jboss.as.clustering.infinispan] (MSC service thread 1-6) DGISPN0001: Started ___script_cache cache from clustered container",
        "&lt;time_stamp&gt; INFO  [org.jboss.as.clustering.infinispan] (MSC service thread 1-5) DGISPN0001: Started ___hotRodTopologyCache cache from clustered container",
        "&lt;time_stamp&gt; INFO  [org.infinispan.rest.NettyRestServer] (MSC service thread 1-6) ISPN012003: REST server starting, listening on 127.0.0.1:8080",
        "&lt;time_stamp&gt; INFO  [org.infinispan.server.endpoint] (MSC service thread 1-6) DGENDPT10002: REST mapped to /rest",
        "&lt;time_stamp&gt; INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:9990/management",
        "&lt;time_stamp&gt; INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://127.0.0.1:9990",
        "&lt;time_stamp&gt; INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: {brandname} Server &lt;build_version&gt; (WildFly Core &lt;build_version&gt;) started in 8681ms - Started 196 of 237 services (121 services are lazy, passive or on-demand)"
    ],
    "number-of-cpus" : 8,
    "number-of-nodes" : 1,
    "total-memory" : 235520
}%</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server_multitenancy">5. Multitenancy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_multi_tenancy">5.1. Multi-tenancy</h3>
<div class="paragraph">
<p>Multi-tenancy allows accessing multiple containers as shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../topics/images/multi-tenancy.png" alt="multi tenancy">
</div>
</div>
<div class="paragraph">
<p>Currently there are two supported protocols for accessing the data - using Hot Rod client and using REST interface.</p>
</div>
</div>
<div class="sect2">
<h3 id="_multi_tenancy_with_rest">5.2. Multi-tenancy with REST</h3>
<div class="paragraph">
<p>Multi-tenancy router uses URL prefixes to separate containers using the following template: <code><a href="https://&lt;server_ip&gt;:&lt;server_port&gt;/rest/&lt;rest_connector_name&gt;/&lt;cache_name&gt;/&lt;key&gt" class="bare">https://&lt;server_ip&gt;:&lt;server_port&gt;/rest/&lt;rest_connector_name&gt;/&lt;cache_name&gt;/&lt;key&gt</a>;</code>. All HTTP operations remain exactly the same as using standard <code>rest-connector</code>.</p>
</div>
<div class="paragraph">
<p>The REST connector by default support both HTTP/1.1 and HTTP/2 protocols. The switching from HTTP/1.1 to HTTP/2 procedure involves
either using TLS/ALPN negotiation or HTTP/1.1 upgrade procedure. The former requires proper encryption to be enabled. The latter
is always enabled.</p>
</div>
</div>
<div class="sect2">
<h3 id="_multi_tenancy_with_hot_rod">5.3. Multi-tenancy with Hot Rod</h3>
<div class="paragraph">
<p>Multi-tenant routing for binary protocols requires using a standard, transport layer mechanism such as <a href="https://en.wikipedia.org/wiki/Server_Name_Indication">SSL/TLS Server Name Indication</a>. The server needs to be configured to support encryption and additional SNI routing needs to be added to the <code>router-connector</code>.</p>
</div>
<div class="paragraph">
<p>In order to connect to a secured Hot Rod server, the client needs to use configuration similar to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ConfigurationBuilder clientBuilder = new ConfigurationBuilder();
clientBuilder
    .addServer()
        .host("127.0.0.1")
        .port(hotrodServer.getPort())
     .security()
        .ssl()
           .enabled(sslClient)
           .sniHostName("hotrod-1") // SNI Host Name
           .trustStoreFileName("truststore.jks")
           .trustStorePassword("secret".toCharArray());
remoteCacheManager = new RemoteCacheManager(clientBuilder.build());</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_multi_tenant_router">5.4. Multi-tenant router</h3>
<div class="paragraph">
<p>The Multi-tenant router endpoint works as a facade for one or more REST/Hot Rod connectors. Its main purpose is to forward client requests into proper container.</p>
</div>
<div class="paragraph">
<p>In order to properly configure the routing, <code>socket-binding</code> attributes of other connectors must be disabled and additional attribute <code>name</code> must be used as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;rest-connector name="rest-1" cache-container="local"/&gt;
&lt;rest-connector name="rest-2" cache-container="local"/&gt;
&lt;hotrod-connector name="hotrod-1" cache-container="local" /&gt;
&lt;hotrod-connector name="hotrod-2" cache-container="local" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next step is to add a new <code>router-connector</code> endpoint and configure how other containers will be accessed. Note that Hot Rod connectors require using TLS/SNI and REST connectors require using prefix in the URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;router-connector hotrod-socket-binding="hotrod" rest-socket-binding="rest" keep-alive="true" tcp-nodelay="false" receive-buffer-size="1024" send-buffer-size="1024"&gt;
    &lt;hotrod name="hotrod-1" &gt;
        &lt;sni host-name="hotrod-1" security-realm="SSLRealm1"/&gt;
    &lt;/hotrod&gt;
    &lt;hotrod name="hotrod-2" &gt;
        &lt;sni host-name="hotrod-2" security-realm="SSLRealm2"/&gt;
    &lt;/hotrod&gt;
    &lt;rest name="rest-1"&gt;
        &lt;prefix path="rest-1" /&gt;
    &lt;/rest&gt;
    &lt;rest name="rest-2"&gt;
        &lt;prefix path="rest-2" /&gt;
    &lt;/rest&gt;
&lt;/router-connector&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the following configuration, Hot Rod clients will access <code>hotrod-1</code> connector when using SNI Host Name "hotrod-1".
REST clients will need to use the following URL to access "rest-1" connector - <code><a href="https://&lt;server_ip&gt;:&lt;server_port&gt;/rest/rest-1" class="bare">https://&lt;server_ip&gt;:&lt;server_port&gt;/rest/rest-1</a></code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-{context}">6. Securing {brandname} Servers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_security_concepts">6.1. Security Concepts</h3>
<div class="sect3">
<h4 id="_authorization">6.1.1. Authorization</h4>
<div class="paragraph">
<p>Just like embedded mode, the server supports cache authorization using the same configuration, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;infinispan&gt;
   &lt;cache-container default-cache="secured" name="secured"&gt;
      &lt;security&gt;
         &lt;authorization&gt;
            &lt;identity-role-mapper /&gt;
            &lt;role name="admin" permissions="ALL" /&gt;
            &lt;role name="reader" permissions="READ" /&gt;
            &lt;role name="writer" permissions="WRITE" /&gt;
            &lt;role name="supervisor" permissions="READ WRITE EXEC"/&gt;
         &lt;/authorization&gt;
      &lt;/security&gt;
      &lt;local-cache name="secured"&gt;
         &lt;security&gt;
            &lt;authorization roles="admin reader writer supervisor" /&gt;
         &lt;/security&gt;
      &lt;/local-cache&gt;
   &lt;/cache-container&gt;

&lt;/infinispan&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_server_realms">6.1.2. Server Realms</h4>
<div class="paragraph">
<p>{brandname} Server security is built around the features provided by the underlying server realm and security domains.
Security Realms are used by the server to provide authentication and authorization information for both the management and application interfaces.</p>
</div>
<div class="listingblock">
<div class="title">Security Realm configuration</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;server xmlns="urn:jboss:domain:2.1"&gt;
   ...
   &lt;management&gt;
        ...
        &lt;security-realm name="ApplicationRealm"&gt;
           &lt;authentication&gt;
              &lt;properties path="application-users.properties" relative-to="jboss.server.config.dir"/&gt;
           &lt;/authentication&gt;
           &lt;authorization&gt;
              &lt;properties path="application-roles.properties" relative-to="jboss.server.config.dir"/&gt;
           &lt;/authorization&gt;
        &lt;/security-realm&gt;
        ...
    &lt;/management&gt;
    ...
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>{brandname} Server comes with an add-user.sh script (add-user.bat for Windows) to ease the process of adding new user/role mappings to the above property files.
An example invocation for adding a user to the ApplicationRealm with an initial set of roles:</p>
</div>
<div class="paragraph">
<p>./bin/add-user.sh -a -u myuser -p "qwer1234!" -ro supervisor,reader,writer</p>
</div>
<div class="paragraph">
<p>It is also possible to authenticate/authorize against alternative sources, such as LDAP, JAAS, etc.</p>
</div>
<div class="paragraph">
<p>Bear in mind that the choice of authentication mechanism you select for the protocols limits the type of authentication sources, since the credentials must be in a format supported by the algorithm itself (e.g. pre-digested passwords for the digest algorithm)</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="security_hotrod_auth">6.2. Hot Rod Authentication</h3>
<div class="paragraph">
<p>The Hot Rod protocol supports authentication by leveraging the SASL mechanisms.
The supported SASL mechanisms (usually shortened as mechs) are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PLAIN - This is the most insecure mech, since credentials are sent over the wire in plain-text format, however it is the simplest to get to work. In combination with encryption (i.e. TLS) it can be used safely</p>
</li>
<li>
<p>DIGEST-MD5 - This mech hashes the credentials before sending them over the wire, so it is more secure than PLAIN</p>
</li>
<li>
<p>GSSAPI - This mech uses Kerberos tickets, and therefore requires the presence of a properly configured Kerberos Domain Controller (such as Microsoft Active Directory)</p>
</li>
<li>
<p>EXTERNAL - This mech obtains credentials from the underlying transport (i.e. from a X.509 client certificate) and therefore requires encryption using client-certificates to be enabled.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following configuration enables authentication against ApplicationRealm, using the DIGEST-MD5 SASL mechanism and only enables the <strong>auth</strong> QoP (see <a href="#security_saslqop">SASL Quality of Protection</a>):</p>
</div>
<div class="listingblock">
<div class="title">Hot Rod connector configuration</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;hotrod-connector socket-binding="hotrod" cache-container="default"&gt;
   &lt;authentication security-realm="ApplicationRealm"&gt;
      &lt;sasl server-name="myhotrodserver" mechanisms="DIGEST-MD5" qop="auth" /&gt;
   &lt;/authentication&gt;
&lt;/hotrod-connector&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the server-name attribute: it is the name that the server declares to incoming clients and therefore the client configuration must match.
It is particularly important when using GSSAPI as it is equivalent to the Kerberos service name.
You can specify multiple mechanisms and they will be attempted in order.</p>
</div>
<div class="sect3">
<h4 id="security_saslqop">6.2.1. SASL Quality of Protection</h4>
<div class="paragraph">
<p>While the main purpose of SASL is to provide authentication, some mechanisms also support integrity and privacy protection, also known as Quality of Protection (or qop).
During authentication negotiation, ciphers are exchanged between client and server, and they can be used to add checksums and encryption to all subsequent traffic.
You can tune the required level of qop as follows:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">QOP</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">auth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">auth-int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication with integrity protection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">auth-conf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication with integrity and privacy protection</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_sasl_policies">6.2.2. SASL Policies</h4>
<div class="paragraph">
<p>You can further refine the way a mechanism is chosen by tuning the SASL policies.
This will effectively include / exclude mechanisms based on whether they match the desired policies.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Policy</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">forward-secrecy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the selected SASL mechanism must support forward secrecy between sessions. This means that breaking into one session will not automatically provide information for breaking into future sessions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pass-credentials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the selected SASL mechanism must require client credentials.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no-plain-text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the selected SASL mechanism must not be susceptible to simple plain passive attacks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no-active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the selected SASL mechanism must not be susceptible to active (non-dictionary) attacks. The mechanism might require mutual authentication as a way to prevent active attacks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no-dictionary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the selected SASL mechanism must not be susceptible to passive dictionary attacks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no-anonymous</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the selected SASL mechanism must not accept anonymous logins.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each policy&#8217;s value is either "true" or "false".
If a policy is absent, then the chosen mechanism need not have that characteristic (equivalent to setting the policy to "false").
One notable exception is the <strong>no-anonymous</strong> policy which, if absent, defaults to true, thus preventing anonymous connections.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is possible to have mixed anonymous and authenticated connections to the endpoint, delegating actual access logic to cache
authorization configuration. To do so, set the <strong>no-anonymous</strong> policy to false and turn on cache authorization.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following configuration selects all available mechanisms, but effectively only enables GSSAPI, since it is the only one that respects all chosen policies:</p>
</div>
<div class="listingblock">
<div class="title">Hot Rod connector policies</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;hotrod-connector socket-binding="hotrod" cache-container="default"&gt;
   &lt;authentication security-realm="ApplicationRealm"&gt;
      &lt;sasl server-name="myhotrodserver" mechanisms="PLAIN DIGEST-MD5 GSSAPI EXTERNAL" qop="auth"&gt;
         &lt;policy&gt;
            &lt;no-active value="true" /&gt;
            &lt;no-anonymous value="true" /&gt;
            &lt;no-plain-text value="true" /&gt;
         &lt;/policy&lt;&gt;
      &lt;/sasl&gt;
   &lt;/authentication&gt;
&lt;/hotrod-connector&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_gssapikerberos">6.2.3. Using GSSAPI/Kerberos</h4>
<div class="paragraph">
<p>If you want to use GSSAPI/Kerberos, setup and configuration differs. First we need to define a Kerberos login module using the security domain subsystem:</p>
</div>
<div class="listingblock">
<div class="title">Security domain configuration</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;system-properties&gt;
    &lt;property name="java.security.krb5.conf" value="/tmp/infinispan/krb5.conf"/&gt;
    &lt;property name="java.security.krb5.debug" value="true"/&gt;
    &lt;property name="jboss.security.disable.secdomain.option" value="true"/&gt;
&lt;/system-properties&gt;

&lt;security-domain name="infinispan-server" cache-type="default"&gt;
    &lt;authentication&gt;
        &lt;login-module code="Kerberos" flag="required"&gt;
            &lt;module-option name="debug" value="true"/&gt;
            &lt;module-option name="storeKey" value="true"/&gt;
            &lt;module-option name="refreshKrb5Config" value="true"/&gt;
            &lt;module-option name="useKeyTab" value="true"/&gt;
            &lt;module-option name="doNotPrompt" value="true"/&gt;
            &lt;module-option name="keyTab" value="/tmp/infinispan/infinispan.keytab"/&gt;
            &lt;module-option name="principal" value="HOTROD/localhost@INFINISPAN.ORG"/&gt;
        &lt;/login-module&gt;
    &lt;/authentication&gt;
&lt;/security-domain&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we need to modify the Hot Rod connector</p>
</div>
<div class="listingblock">
<div class="title">Hot Rod connector configuration</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;hotrod-connector socket-binding="hotrod" cache-container="default"&gt;
   &lt;authentication security-realm="ApplicationRealm"&gt;
      &lt;sasl server-name="infinispan-server" server-context-name="infinispan-server" mechanisms="GSSAPI" qop="auth" /&gt;
   &lt;/authentication&gt;
&lt;/hotrod-connector&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="security_hotrod_rest_encryption">6.3. Hot Rod and REST encryption (TLS/SSL)</h3>
<div class="paragraph">
<p>Both Hot Rod and REST protocols support encryption using SSL/TLS with optional TLS/SNI support (<a href="https://en.wikipedia.org/wiki/Server_Name_Indication">Server Name Indication</a>). To set this up you need to create a keystore using the keytool application which is part of the JDK to store your server certificate. Then add a &lt;server-identities&gt; element to your security realm:</p>
</div>
<div class="listingblock">
<div class="title">Security Realm configuration for SSL</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;security-realm name="ApplicationRealm"&gt;
    &lt;server-identities&gt;
        &lt;ssl&gt;
            &lt;keystore path="keystore_server.jks" relative-to="jboss.server.config.dir" keystore-password="secret" /&gt;
        &lt;/ssl&gt;
    &lt;/server-identities&gt;
&lt;/security-realm&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using SNI support there might be multiple Security Realms configured.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is also possible to generate development certificates on server startup. In order to do this, just specify <code>generate-self-signed-certificate-host</code>
in the keystore element as shown below:</p>
</div>
<div class="listingblock">
<div class="title">Generating Keystore automatically</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;security-realm name="ApplicationRealm"&gt;
    &lt;server-identities&gt;
        &lt;ssl&gt;
            &lt;keystore path="keystore_server.jks" relative-to="jboss.server.config.dir" keystore-password="secret" generate-self-signed-certificate-host="localhost"/&gt;
        &lt;/ssl&gt;
    &lt;/server-identities&gt;
&lt;/security-realm&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There are three basic principles that you should remember when using automatically generated keystores:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>They shouldn&#8217;t be used on a production environment</p>
</li>
<li>
<p>They are generated when necessary (e.g. while obtaining the first connection from the client)</p>
</li>
<li>
<p>They contain also certificates so they might be used in a Hot Rod client directly</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next modify the &lt;hotrod-connector&gt; and/or &lt;rest-connector&gt; elements in the endpoint subsystem to require encryption.
Optionally add SNI configuration:</p>
</div>
<div class="listingblock">
<div class="title">Hot Rod connector SSL configuration</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;hotrod-connector socket-binding="hotrod" cache-container="local"&gt;
    &lt;encryption security-realm="ApplicationRealm" require-ssl-client-auth="false"&gt;
        &lt;sni host-name="domain1" security-realm="Domain1ApplicationRealm" /&gt;
        &lt;sni host-name="domain2" security-realm="Domain2ApplicationRealm" /&gt;
    &lt;/encryption&gt;
&lt;/hotrod-connector&gt;
&lt;rest-connector socket-binding="rest" cache-container="local"&gt;
    &lt;encryption security-realm="ApplicationRealm" require-ssl-client-auth="false"&gt;
        &lt;sni host-name="domain1" security-realm="Domain1ApplicationRealm" /&gt;
        &lt;sni host-name="domain2" security-realm="Domain2ApplicationRealm" /&gt;
    &lt;/encryption&gt;
&lt;/rest-connector&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To configure the client In order to connect to the server using the Hot Rod protocol, the client needs a trust store containing the public key
of the server(s) you are going to connect to, unless the key was signed by a Certification Authority (CA) trusted by
the JRE.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ConfigurationBuilder clientBuilder = new ConfigurationBuilder();
clientBuilder
    .addServer()
        .host("127.0.0.1")
        .port(11222)
     .security()
        .ssl()
           .enabled(true)
           .sniHostName("domain1")
           .trustStoreFileName("truststore_client.jks")
           .trustStorePassword("secret".toCharArray());
remoteCacheManager = new RemoteCacheManager(clientBuilder.build());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally, you might also want to enable client certificate authentication (and optionally also allow the use of the
EXTERNAL SASL mech to authenticate and authorize clients).
To enable this you will need the security realm on the server to be able to trust incoming client certificates by adding
a trust store:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;security-realm name="ApplicationRealm"&gt;
   &lt;authentication&gt;
      &lt;truststore path="truststore_server.jks" relative-to="jboss.server.config.dir" keystore-password="secret"/&gt;
   &lt;/authentication&gt;
   &lt;server-identities&gt;
       &lt;ssl&gt;
           &lt;keystore path="keystore_server.jks" relative-to="jboss.server.config.dir" keystore-password="secret" /&gt;
       &lt;/ssl&gt;
   &lt;/server-identities&gt;
&lt;/security-realm&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then tell the connector to require a client certificate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;hotrod-connector socket-binding="hotrod" cache-container="local"&gt;
    &lt;encryption security-realm="ApplicationRealm" require-ssl-client-auth="true" /&gt;
&lt;/hotrod-connector&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client, at this point, will also need to specify a keyStore which contains its certificate on top of the trustStore which trusts the server certificate.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="monitoring-{context}">7. Monitoring {brandname} Servers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="server_access_logs">7.1. Access Logs</h3>
<div class="paragraph">
<p>Hot Rod and REST endpoints can record all inbound client requests as log entries with the following categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.infinispan.HOTROD_ACCESS_LOG</code> logging category for the Hot Rod endpoint.</p>
</li>
<li>
<p><code>org.infinispan.REST_ACCESS_LOG</code> logging category for the REST endpoint.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="server_access_logs_enable">7.1.1. Enabling Access Logs</h4>
<div class="paragraph">
<p>Access logs for Hot Rod and REST endpoints are disabled by default. To enable
either logging category, set the level to <code>TRACE</code> in the server configuration file, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;logger category="org.infinispan.HOTROD_ACCESS_LOG" use-parent-handlers="false"&gt;
    &lt;level name="TRACE"/&gt;
    &lt;handlers&gt;
       &lt;handler name="HR-ACCESS-FILE"/&gt;
    &lt;/handlers&gt;
&lt;/logger&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="server_access_logs_properties">7.1.2. Access Log Properties</h4>
<div class="paragraph">
<p>The default format for access logs is as follows:</p>
</div>
<div class="paragraph">
<p><code>%X{address} %X{user} [%d{dd/MMM/yyyy:HH:mm:ss z}] &quot;%X{method} %m %X{protocol}&quot; %X{status} %X{requestSize} %X{responseSize} %X{duration}%n</code></p>
</div>
<div class="paragraph">
<p>The preceding format creates log entries such as the following:</p>
</div>
<div class="paragraph">
<p><code>127.0.0.1 - [30/Oct/2018:12:41:50 CET] "PUT /rest/default/key HTTP/1.1" 404 5 77 10</code></p>
</div>
<div class="paragraph">
<p>Logging properties use the <code>%X{name}</code> notation and let you modify the format of access logs. The following are the default logging properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>address</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either the <code>X-Forwarded-For</code> header or the client IP address.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Principal name, if using authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>method</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method used. <code>PUT</code>, <code>GET</code>, and so on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>protocol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Protocol used. <code>HTTP/1.1</code>, <code>HTTP/2</code>, <code>HOTROD/2.9</code>, and so on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTTP status code for the REST endpoint. <code>OK</code> or an exception for the Hot Rod endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requestSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size, in bytes, of the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>responseSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size, in bytes, of the response.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of milliseconds that the server took to handle the request.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the header name prefixed with <code>h:</code> to log headers that were included in requests; for example, <code>%X{h:User-Agent}</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_monitoring_brandname_servers_over_jmx">7.2. Monitoring {brandname} Servers Over JMX</h3>
<div class="paragraph">
<p>You can monitor an {brandname} Server over JMX in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use JConsole or VisualVM running locally as the same user. This will use a local <a href="http://www.oracle.com/technetwork/java/jvmstat-142257.html">jvmstat</a> connection and requires no additional setup</p>
</li>
<li>
<p>Use JMX remoting (aka JSR-160) to connect from any host. This requires connecting through the management port (usually 9990) using a special protocol which respects the server security configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To setup a client for JMX remoting you need to add the $ISPN_HOME/bin/client/jboss-client.jar to your client&#8217;s classpath and use one of the following service URLs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>service:jmx:remote-http-jmx://host:port</code> for plain connections through the management interface</p>
</li>
<li>
<p><code>service:jmx:remote-https-jmx://host:port</code> for TLS connections through the management interface (although this requires having the appropriate keys available)</p>
</li>
<li>
<p><code>service:jmx:remoting-jmx://localhost:port</code> for connections through the remoting interface (necessary for connecting to individual servers in a domain)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The JMX subsystem registers a service with the Remoting endpoint so that remote access to JMX can be obtained over the exposed Remoting connector.
This is switched on by default in standalone mode and accessible over port 9990 but in domain mode it is switched off so it needs to be enabled.
In domain mode the port will be the port of the Remoting connector for the Server instance to be monitored.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:jmx:1.3"&gt;
    &lt;expose-resolved-model/&gt;
    &lt;expose-expression-model/&gt;
    &lt;remoting-connector use-management-endpoint="false"/&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="jmx_mgmt_tooling">7.2.1. JMX Monitoring</h4>
<div class="paragraph">
<p>Management of {brandname} instances is all about exposing as much relevant statistical information that allows administrators to get a view of the state of each {brandname} instance. Taking in account that a single installation could be made up of several tens or hundreds {brandname} instances, providing clear and concise information in an efficient manner is imperative. The following sections dive into the range of management tooling that {brandname} provides.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Any management tool that supports JMX already has basic support for {brandname}. However, custom plugins could be written to adapt the JMX information for easier consumption.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_jmx">JMX</h5>
<div class="paragraph">
<p>Over the years, <a href="http://www.oracle.com/technetwork/java/javase/tech/javamanagement-140525.html">JMX</a> has become the de facto standard for management and administration of middleware and as a result, the {brandname} team has decided to standardize on this technology for the exposure of management and statistical information.</p>
</div>
<div class="sect5">
<h6 id="_understanding_the_exposed_mbeans">Understanding The Exposed MBeans</h6>
<div class="paragraph">
<p>By connecting to the VM(s) where {brandname} is running with a standard JMX GUI such as <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/management/jconsole.html">JConsole</a> or <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/visualvm/">VisualVM</a> you should find the following MBeans:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For CacheManager level JMX statistics, without further configuration, you should see an MBean called <em>org.infinispan:type=CacheManager,name="DefaultCacheManager"</em> with <a href="{javadocroot}/jmxComponents.html#CacheManager">properties specified by the CacheManager MBean</a> .</p>
</li>
<li>
<p>Using the cacheManagerName attribute in globalJmxStatistics XML element, or using the corresponding GlobalJmxStatisticsConfigurationBuilder.cacheManagerName(String cacheManagerName) call, you can name the cache manager in such way that the name is used as part of the JMX object name. So, if the name had been "Hibernate2LC", the JMX name for the cache manager would have been: <em>org.infinispan:type=CacheManager,name="Hibernate2LC"</em> . This offers a nice and clean way to manage environments where multiple cache managers are deployed, which follows <a href="http://www.oracle.com/technetwork/java/javase/tech/best-practices-jsp-136021.html">JMX best practices</a> .</p>
</li>
<li>
<p>For Cache level JMX statistics, you should see several different MBeans depending on which configuration options have been enabled. For example, if you have configured a write behind cache store, you should see an MBean exposing properties belonging to the cache store component. All Cache level MBeans follow the same format though which is the following: <code>org.infinispan:type=Cache,name="${name-of-cache}(${cache-mode})",manager="${name-of-cache-manager}",component=${component-name}</code> where:</p>
</li>
<li>
<p>${name-of-cache} has been substituted by the actual cache name. If this cache represents the default cache, its name will be <code>___defaultCache</code>.</p>
</li>
<li>
<p>${cache-mode} has been substituted by the cache mode of the cache. The cache mode is represented by the lower case version of the possible enumeration values shown <a href="{javadocroot}/org/infinispan/configuration/cache/CacheMode">here</a>.</p>
</li>
<li>
<p>${name-of-cache-manager} has been substituted by the name of the cache manager to which this cache belongs. The name is derived from the <em>cacheManagerName</em> attribute value in <code>globalJmxStatistics</code> element.</p>
</li>
<li>
<p>${component-name} has been substituted by one of the JMX component names in the <a href="{javadocroot}/jmxComponents.html">JMX reference documentation</a> .</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the cache store JMX component MBean for a default cache configured with synchronous distribution would have the following name: <code>org.infinispan:type=Cache,name="___defaultcache(dist_sync)",manager="DefaultCacheManager",component=CacheStore</code></p>
</div>
<div class="paragraph">
<p>Please note that cache and cache manager names are quoted to protect against illegal characters being used in these user-defined names.</p>
</div>
</div>
<div class="sect5">
<h6 id="_enabling_jmx_statistics">Enabling JMX Statistics</h6>
<div class="paragraph">
<p>The MBeans mentioned in the previous section are always created and registered in the MBeanServer allowing you to manage
your caches but some of their attributes do not expose meaningful values unless you take the extra step of enabling
collection of statistics. Gathering and reporting statistics via JMX can be enabled at 2 different levels:</p>
</div>
<div class="paragraph">
<div class="title">CacheManager level</div>
<p>The CacheManager is the entity that governs all the cache instances that have been created from it.
Enabling CacheManager statistics collections differs depending on the configuration style:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If configuring the CacheManager via XML, make sure you add the following XML under the <code>&lt;cache-container /&gt;</code> element:</p>
<div class="literalblock">
<div class="content">
<pre>&lt;cache-container statistics="true"/&gt;</pre>
</div>
</div>
</li>
<li>
<p>If configuring the CacheManager programmatically, simply add the following code:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">GlobalConfigurationBuilder globalConfigurationBuilder = ...
globalConfigurationBuilder.globalJmxStatistics().enable();</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Cache level</div>
<p>At this level, you will receive management information generated by individual cache instances.
Enabling Cache statistics collections differs depending on the configuration style:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If configuring the Cache via XML, make sure you add the following XML under the one of the top level cache elements, such as <code>&lt;local-cache /&gt;</code>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;local-cache statistics="true"/&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>If configuring the Cache programmatically, simply add the following code:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ConfigurationBuilder configurationBuilder = ...
configurationBuilder.jmxStatistics().enable();</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_monitoring_cluster_health">Monitoring cluster health</h6>
<div class="paragraph">
<p>It is also possible to monitor {brandname} cluster health using JMX. On CacheManager there&#8217;s an additional object called <code>CacheContainerHealth</code>. It contains the following attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cacheHealth - a list of caches and corresponding statuses (HEALTHY, DEGRADED or HEALTHY_REBALANCING)</p>
</li>
<li>
<p>clusterHealth - overall cluster health</p>
</li>
<li>
<p>clusterName - cluster name</p>
</li>
<li>
<p>freeMemoryKb - Free memory obtained from JVM runtime measured in KB</p>
</li>
<li>
<p>numberOfCpus - The number of CPUs obtained from JVM runtime</p>
</li>
<li>
<p>numberOfNodes - The number of nodes in the cluster</p>
</li>
<li>
<p>totalMemoryKb - Total memory obtained from JVM runtime measured in KB</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_multiple_jmx_domains">Multiple JMX Domains</h6>
<div class="paragraph">
<p>There can be situations where several CacheManager instances are created in a single VM, or Cache names belonging to different CacheManagers under the same VM clash.</p>
</div>
<div class="paragraph">
<p>Using different JMX domains for multi cache manager environments should be last resort.
Instead, it&#8217;s possible to name a cache manager in such way that it can easily be identified and used by monitoring tools. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Via XML:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;cache-container statistics="true" name="Hibernate2LC"/&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Programmatically:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">GlobalConfigurationBuilder globalConfigurationBuilder = ...
globalConfigurationBuilder.globalJmxStatistics()
    .enable()
    .cacheManagerName("Hibernate2LC");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using either of these options should result on the CacheManager MBean name being: <code>org.infinispan:type=CacheManager,name="Hibernate2LC"</code></p>
</div>
<div class="paragraph">
<p>For the time being, you can still set your own jmxDomain if you need to and we also allow duplicate domains, or rather duplicate JMX names, but these should be limited to very special cases where different cache managers within the same JVM are named equally.</p>
</div>
</div>
<div class="sect5">
<h6 id="_registering_mbeans_in_non_default_mbean_servers">Registering MBeans In Non-Default MBean Servers</h6>
<div class="paragraph">
<p>Let&#8217;s discuss where {brandname} registers all these MBeans. By default, {brandname} registers them in the <a href="{jdkdocroot}/java/lang/management/ManagementFactory.html#getPlatformMBeanServer--">standard JVM MBeanServer platform</a> . However, users might want to register these MBeans in a different MBeanServer instance. For example, an application server might work with a different MBeanServer instance to the default platform one. In such cases, users should implement the <a href="{javadocroot}/org/infinispan/jmx/MBeanServerLookup.html">MBeanServerLookup interface</a> provided by {brandname} so that the <a href="{javadocroot}/org/infinispan/jmx/MBeanServerLookup.html#getMBeanServer--">getMBeanServer() method</a> returns the MBeanServer under which {brandname} should register the management MBeans. Once you have your implementation ready, simply configure {brandname} with the fully qualified name of this class. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Via XML:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;cache-container statistics="true"&gt;
   &lt;jmx mbean-server-lookup="com.acme.MyMBeanServerLookup" /&gt;
&lt;/cache-container&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Programmatically:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">GlobalConfigurationBuilder globalConfigurationBuilder = ...
globalConfigurationBuilder.globalJmxStatistics()
    .enable()
    .mBeanServerLookup(new com.acme.MyMBeanServerLookup());</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_available_mbeans">Available MBeans</h6>
<div class="paragraph">
<p>For a complete list of available MBeans, refer to the <a href="{javadocroot}/jmxComponents.html">JMX reference documentation</a></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jmx_with_prometheus">7.2.2. JMX with Prometheus</h4>
<div class="paragraph">
<p>You can also expose JMX beans using <a href="https://prometheus.io/docs/prometheus/latest/querying/api/">Prometheus</a>.
In order to do this, just run the server with additional parameter <code>--jmx</code>, for example: <code>./standalone.xml -c cloud.xml --jmx</code>.
Prometheus configuration is stored in <code>prometheus_config.yaml</code> file. It is possible to override this file by specifying it
after <code>--jmx</code> parameter. For example: <code>./standalone.sh -c cloud.xml --jmx my-config.yaml</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server_single_port">8. Single Port</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Single-Port is a special type of router connector which allows exposing multiple protocols over the same TCP port.
This approach is very convenient because it reduces the number of ports required by a server, with advantages in security, configuration and management.
Protocol switching is handled in three ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>HTTP/1.1 Upgrade header</strong>: initiate an HTTP/1.1 connection and send an <code>Upgrade: protocol</code> header where protocol is the name assigned to the desired endpoint.</p>
</li>
<li>
<p><strong>TLS/ALPN</strong>: protocol selection is performed based on the SNI specified by the client.</p>
</li>
<li>
<p><strong>Hot Rod header detection</strong>: if a Hot Rod endpoint is present in the router configuration, then any attempt to send a Hot Rod header will be detected and the protocol will be switched automatically.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The initial implementation supports only HTTP/1.1, HTTP/2 and Hot Rod protocols. The Memcached protocol is not supported.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_single_port_router">8.1. Single-Port router</h3>
<div class="paragraph">
<p>Internally, Single-Port is based on the same router component used to enable multi-tenancy, and therefore it shares the same configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;!-- TLS/ALPN negotiation --&gt;
&lt;router-connector name="router-ssl" single-port-socket-binding="rest-ssl"&gt;
    &lt;single-port security-realm="SSLRealm1"&gt;
        &lt;hotrod name="hotrod" /&gt;
        &lt;rest name="rest" /&gt;
    &lt;/single-port&gt;
&lt;/router-connector&gt;
&lt;!-- HTTP 1.1/Upgrade procedure --&gt;
&lt;router-connector name="router" single-port-socket-binding="rest"&gt;
    &lt;single-port&gt;
        &lt;hotrod name="hotrod" /&gt;
        &lt;rest name="rest" /&gt;
    &lt;/single-port&gt;
&lt;/router-connector&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the configuration above, the Single-Port Router will operate on <code>rest</code> and <code>rest-ssl</code> socket
bindings. The router named <code>router</code> should typically operate on port <code>8080</code> and will use HTTP/1.1 Upgrade
(also known as <em>cleartext upgrade</em>) procedure. The other router instance (called <code>router-ssl</code>) should typically
operate on port <code>8443</code> and will use TLS/ALPN.</p>
</div>
<div class="sect3">
<h4 id="_testing_the_single_port_router">8.1.1. Testing the Single-Port router</h4>
<div class="paragraph">
<p>A tool such as <code>curl</code> can be used to access cache using both <em>cleartext upgrade</em> or TLS/ALPN. Here&#8217;s an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ curl -v -k --http2-prior-knowledge https://127.0.0.1:8443/rest/default/test</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--http2-prior-knowledge</code> can be exchanged with <code>--http2</code> switch allowing to control how the switch procedure
is being done (via Plain-Text Upgrade or TLS/ALPN).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hot_rod_protocol_detection">8.2. Hot Rod Protocol Detection</h3>
<div class="paragraph">
<p>The single-port router has built-in automatic detection of Hot Rod messages which trigger a transparent "upgrade" to the
Hot Rod protocol. This means that no changes are required on the client side to connect to a single-port endpoint.
It also means that older clients will also be able to function seamlessly.</p>
</div>
<div class="sect3">
<h4 id="_tlsalpn_protocol_selection">8.2.1. TLS/ALPN protocol selection</h4>
<div class="paragraph">
<p>Another supported way to select the protocol is to use TLS/ALPN which uses the <a href="https://tools.ietf.org/html/rfc7301">Application-Layer Protocol Negotiation</a> spec. This feature requires that you have configured your endpoint to enable TLS.</p>
</div>
<div class="sect4">
<h5 id="_enabling_alpn">Enabling ALPN</h5>
<div class="paragraph">
<p>If you are using JDK 9 or greater, ALPN is
supported by default. However, if you are using JDK 8, you will need to use
<a href="https://netty.io/wiki/forked-tomcat-native.html">Netty&#8217;s BoringSSL</a> library, which leverages native libraries to enable ALPN.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add Netty dependencies.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;dependencyManagement&gt;
      &lt;dependency&gt;
         &lt;groupId&gt;io.netty&lt;/groupId&gt;
         &lt;artifactId&gt;netty-bom&lt;/artifactId&gt;
         &lt;!-- Pulled from Infinispan BOM --&gt;
         &lt;version&gt;${version.netty}&lt;/version&gt;
         &lt;type&gt;pom&lt;/type&gt;
         &lt;scope&gt;import&lt;/scope&gt;
      &lt;/dependency&gt;
   &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;

&lt;dependency&gt;
   &lt;groupId&gt;io.netty&lt;/groupId&gt;
   &lt;artifactId&gt;netty-tcnative-boringssl-static&lt;/artifactId&gt;
   &lt;!-- The version is defined in Netty BOM --&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Configure your trust store accordingly:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ConfigurationBuilder builder = new ConfigurationBuilder()
      .addServers("127.0.0.1:8443");

builder.security().ssl().enable()
      .trustStoreFileName("truststore.pkcs12")
      .trustStorePassword(DEFAULT_TRUSTSTORE_PASSWORD.toCharArray());

RemoteCacheManager remoteCacheManager = new RemoteCacheManager(builder.build());
RemoteCache&lt;String, String&gt; cache = remoteCacheManager.getCache("default"");</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server_rolling_upgrade">9. Performing Rolling Upgrades</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Upgrade {brandname} without downtime or data loss. You can perform rolling upgrades for {brandname} servers to start using a more recent version of {brandname}.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This section explains how to upgrade {brandname} servers, see the appropriate documentation for your Hot Rod client for upgrade procedures.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_rolling_upgrades">9.1. Rolling Upgrades</h3>
<div class="paragraph">
<p>From a high-level, you do the following to perform rolling upgrades:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set up a target cluster. The target cluster is the {brandname} version to which you want to migrate data. The source cluster is the {brandname} deployment that is currently in use. After the target cluster is running, you configure all clients to point to it instead of the source cluster.</p>
</li>
<li>
<p>Synchronize data from the source cluster to the target cluster.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_target_clusters">9.2. Setting Up Target Clusters</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start the target cluster with unique network properties or a different JGroups cluster name to keep it separate from the source cluster.</p>
</li>
<li>
<p>Configure a <code>RemoteCacheStore</code> on the target cluster for each cache you want to migrate from the source cluster.</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>RemoteCacheStore</code> settings</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>remote-server</code> must point to the source cluster via the <code>outbound-socket-binding</code> property.</p>
</li>
<li>
<p><code>remoteCacheName</code> must match the cache name on the source cluster.</p>
</li>
<li>
<p><code>hotrod-wrapping</code> must be <code>true</code> (enabled).</p>
</li>
<li>
<p><code>shared</code> must be <code>true</code> (enabled).</p>
</li>
<li>
<p><code>purge</code> must be <code>false</code> (disabled).</p>
</li>
<li>
<p><code>passivation</code> must be <code>false</code> (disabled).</p>
</li>
<li>
<p><code>protocol-version</code> matches the Hot Rod protocol version of the source cluster.</p>
<div class="listingblock">
<div class="title">Example <code>RemoteCacheStore</code> Configuration</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;distributed-cache&gt;
   &lt;remote-store cache="MyCache" socket-timeout="60000" tcp-no-delay="true" protocol-version="2.5" shared="true" hotrod-wrapping="true" purge="false" passivation="false"&gt;
      &lt;remote-server outbound-socket-binding="remote-store-hotrod-server"/&gt;
   &lt;/remote-store&gt;
&lt;/distributed-cache&gt;
...
&lt;socket-binding-group name="standard-sockets" default-interface="public" port-offset="${jboss.socket.binding.port-offset:0}"&gt;
  ...
  &lt;outbound-socket-binding name="remote-store-hotrod-server"&gt;
     &lt;remote-destination host="198.51.100.0" port="11222"/&gt;
  &lt;/outbound-socket-binding&gt;
  ...
&lt;/socket-binding-group&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>Configure the target cluster to handle all client requests instead of the source cluster:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Configure all clients to point to the target cluster instead of the source cluster.</p>
</li>
<li>
<p>Restart each client node.</p>
<div class="paragraph">
<p>The target cluster lazily loads data from the source cluster on demand via <code>RemoteCacheStore</code>.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_synchronizing_data_from_source_clusters">9.3. Synchronizing Data from Source Clusters</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Call the <code>synchronizeData()</code> method in the <code>TargetMigrator</code> interface. Do one of the following on the target cluster for each cache that you want to migrate:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">JMX</dt>
<dd>
<div class="paragraph">
<p>Invoke the <code>synchronizeData</code> operation and specify the <code>hotrod</code> parameter on the <code>RollingUpgradeManager</code> MBean.</p>
</div>
</dd>
<dt class="hdlist1">CLI</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ bin/cli.sh --connect controller=127.0.0.1:9990 -c "/subsystem=datagrid-infinispan/cache-container=clustered/distributed-cache=MyCache:synchronize-data(migrator-name=hotrod)"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Data migrates to all nodes in the target cluster in parallel, with each node
receiving a subset of the data.</p>
</div>
<div class="paragraph">
<p>Use the following parameters to tune the operation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>read-batch</code> configures the number of entries to read from the source cluster at a time. The default value is <code>10000</code>.</p>
</li>
<li>
<p><code>write-threads</code> configures the number of threads used to write data. The default value is the number of processors available.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="paragraph">
<p><code>synchronize-data(migrator-name=hotrod, read-batch=100000, write-threads=3)</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>Disable the <code>RemoteCacheStore</code> on the target cluster. Do one of the following:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">JMX</dt>
<dd>
<div class="paragraph">
<p>Invoke the <code>disconnectSource</code> operation and specify the <code>hotrod</code> parameter on the <code>RollingUpgradeManager</code> MBean.</p>
</div>
</dd>
<dt class="hdlist1">CLI</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ bin/cli.sh --connect controller=127.0.0.1:9990 -c "/subsystem=datagrid-infinispan/cache-container=clustered/distributed-cache=MyCache:disconnect-source(migrator-name=hotrod)"</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>Decommission the source cluster.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-10-11 12:52:34 IST
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>